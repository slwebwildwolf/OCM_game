require=function e(t,i,n){function a(s,o){if(!i[s]){if(!t[s]){var r="function"==typeof require&&require;if(!o&&r)return r(s,!0);if(c)return c(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var p=i[s]={exports:{}};t[s][0].call(p.exports,function(e){var i=t[s][1][e];return a(i?i:e)},p,p.exports,e,t,i,n)}return i[s].exports}for(var c="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({button:[function(e,t,i){"use strict";cc._RFpush(t,"d0fdaRs70dKU4BCrYx9Rann","button"),cc.Class({"extends":cc.Component,properties:{},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(e){cc.director.loadScene("game")})}}),cc._RFpop()},{}],enemy:[function(e,t,i){"use strict";cc._RFpush(t,"d586aPFZo5KupJfrqUVLXK5","enemy"),cc.Class({"extends":cc.Component,properties:{pickRadius:0,speed:0,atk:0,hp:0,exp:0,crit:0,dodge:0,dropRate:0,dieAudio:{"default":null,url:cc.AudioClip}},onLoad:function(){this.isPicked=!1,this.face="left"},getPlayerDistance:function(){var e=this.game.player.getPosition(),t=cc.pDistance(this.node.position,e);return t},onPicked:function(e){var t=this.game.player.getPosition(),i=this.getComponent(cc.Animation),n=cc.pNormalize(cc.pSub(t,this.node.position));n.x>0?(i.play("enemyMoveRight"),this.face="right"):(i.play("enemyMoveLeft"),this.face="left"),this.node.x+=this.speed*n.x*e*cc.random0To1(),this.node.y+=this.speed*n.y*e*cc.random0To1()},findSpears:function(){var e=this.game.spearArr;if(e.length>0){var t=this.node.x,i=this.node.y;for(var n in e){var a=Math.abs(t-e[n].x),c=Math.abs(i-e[n].y);50>a&&20>c&&(this.onAttack(),e[n].destroy(),e.splice(n,1))}}},onAttack:function(){if(this.isPicked=!0,cc.random0To1()<this.dodge)this.game.drawDamage(this.node,"Miss",!0);else{var e=cc.blink(.2,2);this.node.runAction(e);var t=this.game.player.getComponent("player"),i=t.atk*(1+.1*cc.randomMinus1To1()),n=0;cc.random0To1()<t.crit?(n=Math.floor(1.5*i),this.game.drawDamage(this.node,n,!0)):(n=Math.floor(i),this.game.drawDamage(this.node,n,!1)),this.hp-=n,this.hp<=0&&this.dead()}},dead:function(){cc.fadeOut(.2);cc.random0To1()<this.dropRate&&this.game.drawHeart(this.node),this.game.player.getComponent("player").getExp(this.exp),this.game.enemyNum-=1,cc.audioEngine.playEffect(this.dieAudio,!1),this.node.destroy()},atkPlayer:function(){var e=this.game.player,t=cc.rect(e.x,e.y,e.width,e.height),i=cc.rect(this.node.x,this.node.y,this.node.width,this.node.height),n=cc.rectIntersectsRect(t,i);n&&!e.getComponent("player").isOnAtk&&(e.getComponent("player").isOnAtk=!0,e.getComponent("player").onAttack(this.node))},update:function(e){this.getPlayerDistance()<this.pickRadius&&(this.isPicked=!0),this.isPicked&&this.onPicked(e),this.findSpears(),this.atkPlayer()}}),cc._RFpop()},{}],game:[function(e,t,i){"use strict";cc._RFpush(t,"1cd81j4Q5VF9ocWR01PhxV4","game"),cc.Class({"extends":cc.Component,properties:{enemyPrefab:{"default":null,type:cc.Prefab},ground:{"default":null,type:cc.Node},player:{"default":null,type:cc.Node},spearPrefab:{"default":null,type:cc.Prefab},damagePrefab:{"default":null,type:cc.Prefab},heartPrefab:{"default":null,type:cc.Prefab},soulBar:{"default":null,type:cc.ProgressBar},hpBar:{"default":null,type:cc.ProgressBar},level:{"default":null,type:cc.Label}},onLoad:function(){this.spearArr=[],this.enemyNum=0,this.player.getComponent("player").game=this,this.drawEnemys()},update:function(){this.enemyNum<1&&this.drawEnemys()},drawEnemys:function(){for(var e=0;5>e;e++){var t=cc.instantiate(this.enemyPrefab);this.node.addChild(t),this.enemyNum+=1,t.setPosition(this.getEnemyPosition()),t.getComponent("enemy").game=this}},getEnemyPosition:function(){var e=this.node.width-250,t=this.ground.height/2-this.player.height/2,i=cc.random0To1()*e+225-this.node.width/2,n=cc.randomMinus1To1()*t;return cc.p(i,n)},drawSpear:function(){var e=cc.instantiate(this.spearPrefab);this.node.addChild(e),this.spearArr.push(e),e.getComponent("spear").game=this,"left"==this.player.getComponent("player").face?(e.setPosition(this.getSpPosition(!0)),e.getComponent("spear").dr="left"):"right"==this.player.getComponent("player").face&&(e.setPosition(this.getSpPosition(!1)),e.getComponent("spear").dr="right")},getSpPosition:function(e){var t,i=this.player.y;return t=e?this.player.x-this.player.width:this.player.x+this.player.width,cc.p(t,i)},drawDamage:function(e,t,i){var n=cc.instantiate(this.damagePrefab);this.node.addChild(n),n.setPosition(this.getDamagePosition(e)),n.getComponent(cc.Label).string=t,i?n.getComponent(cc.Label).fontSize=20:n.getComponent(cc.Label).fontSize=15;var a=cc.jumpBy(.2,0,20,20,1),c=cc.fadeOut(.1),s=cc.callFunc(function(){n.destroy()},this);n.runAction(cc.sequence(a,c,s))},getDamagePosition:function(e){var t=e.x,i=e.y+e.height/2;return cc.p(t,i)},drawHeart:function(e){var t=cc.instantiate(this.heartPrefab);this.node.addChild(t),t.setPosition(cc.p(e.x,e.y));var i=cc.jumpBy(.2,20,0,20,1);t.runAction(i),t.getComponent("heart").game=this}}),cc._RFpop()},{}],heart:[function(e,t,i){"use strict";cc._RFpush(t,"e8bcby5UElBArcHTAHGJKDt","heart"),cc.Class({"extends":cc.Component,properties:{heal:0,pickRadius:0,jumpHeight:0,jumpDuration:0,pickAudio:{"default":null,url:cc.AudioClip}},getPlayerDistance:function(){var e=this.game.player.getPosition(),t=cc.pDistance(this.node.position,e);return t},onPicked:function(){cc.audioEngine.playEffect(this.pickAudio,!1);var e=this.game.player.getComponent("player").hp,t=this.game.player.getComponent("player").maxHp,i=e+this.heal;i>t?e=t:this.game.player.getComponent("player").hp+=this.heal,this.game.hpBar.progress=this.game.player.getComponent("player").hp/this.game.player.getComponent("player").maxHp,this.node.destroy()},onLoad:function(){var e=cc.moveBy(this.jumpDuration,cc.p(0,this.jumpHeight)).easing(cc.easeCubicActionOut()),t=cc.moveBy(this.jumpDuration,cc.p(0,-this.jumpHeight)).easing(cc.easeCubicActionIn());this.node.runAction(cc.repeatForever(cc.sequence(e,t)))},update:function(e){return this.getPlayerDistance()<this.pickRadius?void this.onPicked():void 0}}),cc._RFpop()},{}],player:[function(e,t,i){"use strict";cc._RFpush(t,"692d4GufVhF8ID8qoCvOnfH","player"),cc.Class({"extends":cc.Component,properties:{speed:0,atk:0,maxHp:0,hp:0,exp:0,needExp:0,crit:0,dodge:0,level:0,atkAudio:{"default":null,url:cc.AudioClip},levelUpAudio:{"default":null,url:cc.AudioClip}},changeDirection:function(e){this.getComponent(cc.Animation).playAdditive("playerMove"+e)},setInputControl:function(){var e=this;cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,i){switch(t){case cc.KEY.left:e.accLeft=!0,e.accRight=!1,e.face="left",e.attackAnimPlaying=!0;break;case cc.KEY.right:e.accLeft=!1,e.accRight=!0,e.face="right",e.attackAnimPlaying=!0;break;case cc.KEY.up:e.accUp=!0,e.accDown=!1,e.attackAnimPlaying=!0;break;case cc.KEY.down:e.accUp=!1,e.accDown=!0,e.attackAnimPlaying=!0;break;case cc.KEY.space:e.playerAttack=!0}},onKeyReleased:function(t,i){switch(t){case cc.KEY.left:e.accLeft=!1,e.attackAnimPlaying=!1;break;case cc.KEY.right:e.accRight=!1,e.attackAnimPlaying=!1;break;case cc.KEY.up:e.accUp=!1,e.attackAnimPlaying=!1;break;case cc.KEY.down:e.accDown=!1,e.attackAnimPlaying=!1;break;case cc.KEY.space:e.playerAttack=!1}}},e.node)},onAttackAnimCompleted:function(){this.attackAnimPlaying=!1},onHandsUp:function(){this.game.drawSpear()},getExp:function(e){this.exp+=e,this.exp>this.needExp?this.levelUp():this.game.soulBar.progress=this.exp/this.needExp},levelUp:function(){this.exp-=this.needExp,this.game.soulBar.progress=this.exp/this.needExp,this.level+=1,this.needExp=100*this.level,this.maxHp+=50*this.level,this.game.enemyPrefab.atk+=10*this.level,this.hp=this.maxHp,this.game.hpBar.progress=this.hp/this.maxHp,this.game.level.string="Lv "+this.level.toString(),cc.audioEngine.playEffect(this.levelUpAudio,!1)},onAttack:function(e){if(cc.random0To1()<this.dodge)this.game.drawDamage(this.node,"Miss",!0),this.isOnAtk=!1;else{var t,i=e.getComponent("enemy"),n=cc.blink(.6,3),a=cc.callFunc(function(){this.isOnAtk=!1},this);"left"==i.face&&this.node.x>-405&&(t=cc.jumpBy(.2,-50,0,10,1)),"right"==i.face&&this.node.x<405&&(t=cc.jumpBy(.2,50,0,10,1)),t?this.node.runAction(cc.sequence(t,n,a)):this.node.runAction(cc.sequence(n,a));var c=i.atk*(1+.1*cc.randomMinus1To1()),s=0;cc.random0To1()<i.crit?(s=Math.floor(1.5*c),this.game.drawDamage(this.node,s,!0)):(s=Math.floor(c),this.game.drawDamage(this.node,s,!1)),this.hp-=s,this.game.hpBar.progress=this.hp/this.maxHp,this.hp<=0&&cc.director.loadScene("End")}},onLoad:function(){this.hp=this.maxHp,this.accLeft=!1,this.accRight=!1,this.accUp=!1,this.accDown=!1,this.face="right",this.playerAttack=!1,this.attackAnimPlaying=!1,this.isOnAtk=!1,this.setInputControl()},update:function(e){this.accLeft&&this.node.x>-455?(this.node.x-=this.speed*e,this.changeDirection("Left")):this.accRight&&this.node.x<455&&(this.node.x+=this.speed*e,this.changeDirection("Right")),this.accUp&&this.node.y<260?this.node.y+=this.speed*e:this.accDown&&this.node.y>-180&&(this.node.y-=this.speed*e);var t=this.getComponent(cc.Animation);this.playerAttack&&!this.attackAnimPlaying&&(this.attackAnimPlaying=!0,cc.audioEngine.playEffect(this.atkAudio,!1),"left"==this.face?t.play("playerAttackLeft"):"right"==this.face&&t.play("playerAttackRight"))}}),cc._RFpop()},{}],spear:[function(e,t,i){"use strict";cc._RFpush(t,"fa146+erjhDgrqpRLpyJB/6","spear"),cc.Class({"extends":cc.Component,properties:{pickWidth:0,speed:0,duration:0},onLoad:function(){this.timer=0},update:function(e){if("left"==this.dr?this.node.x-=this.speed*e:"right"==this.dr&&(this.node.x+=this.speed*e),this.timer>this.duration){var t=this.game.spearArr,i=t.indexOf(this.node);if(this.node)return t.splice(i,1),void this.node.destroy()}this.timer+=e}}),cc._RFpop()},{}]},{},["game","player","button","enemy","heart","spear"]);